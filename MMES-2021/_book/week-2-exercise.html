<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Week 2 Exercise | MMES Quantitative Research Methods Oxford 2021</title>
  <meta name="description" content="This is a working version of MMES Quant. Methods materials book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Week 2 Exercise | MMES Quantitative Research Methods Oxford 2021" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/Bahre_Fars.jpeg" />
  <meta property="og:description" content="This is a working version of MMES Quant. Methods materials book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="cjbarrie/bookdown_template" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Week 2 Exercise | MMES Quantitative Research Methods Oxford 2021" />
  
  <meta name="twitter:description" content="This is a working version of MMES Quant. Methods materials book. The output format for this example is bookdown::gitbook." />
  <meta name="twitter:image" content="images/Bahre_Fars.jpeg" />

<meta name="author" content="Christopher Barrie" />


<meta name="date" content="2021-02-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="week-1-exercise.html"/>
<link rel="next" href="week-3-exercise.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>
<link href="libs/leaflet-minimap-3.3.1/Control.MiniMap.min.css" rel="stylesheet" />
<script src="libs/leaflet-minimap-3.3.1/Control.MiniMap.min.js"></script>
<script src="libs/leaflet-minimap-3.3.1/Minimap-binding.js"></script>
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.css" rel="stylesheet" />
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.Default.css" rel="stylesheet" />
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.freezable.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.layersupport.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MMES Oxford 2021</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>A note on this document</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#structure-of-seminars"><i class="fa fa-check"></i>Structure of seminars</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#course-content"><i class="fa fa-check"></i>Course content</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#take-home-assignments"><i class="fa fa-check"></i>Take-home assignments</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#a-final-word"><i class="fa fa-check"></i>A final word</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="week-1-surveys-and-experiments.html"><a href="week-1-surveys-and-experiments.html"><i class="fa fa-check"></i>Week 1: Surveys and experiments</a></li>
<li class="chapter" data-level="" data-path="week-2-event-data.html"><a href="week-2-event-data.html"><i class="fa fa-check"></i>Week 2: Event data</a></li>
<li class="chapter" data-level="" data-path="week-3-spatial-data.html"><a href="week-3-spatial-data.html"><i class="fa fa-check"></i>Week 3: Spatial data</a></li>
<li class="chapter" data-level="" data-path="week-4-online-and-text-data.html"><a href="week-4-online-and-text-data.html"><i class="fa fa-check"></i>Week 4: Online and text data</a></li>
<li class="chapter" data-level="" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i>Introduction to R</a><ul>
<li class="chapter" data-level="" data-path="introduction-to-r.html"><a href="introduction-to-r.html#introduction-1"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="introduction-to-r.html"><a href="introduction-to-r.html#getting-started-with-r-at-home"><i class="fa fa-check"></i>Getting started with R at home</a></li>
<li class="chapter" data-level="" data-path="introduction-to-r.html"><a href="introduction-to-r.html#some-basic-information"><i class="fa fa-check"></i>Some basic information</a></li>
<li class="chapter" data-level="" data-path="introduction-to-r.html"><a href="introduction-to-r.html#getting-started-in-rstudio"><i class="fa fa-check"></i>Getting Started in RStudio</a></li>
<li class="chapter" data-level="" data-path="introduction-to-r.html"><a href="introduction-to-r.html#a-simple-example"><i class="fa fa-check"></i>A simple example</a></li>
<li class="chapter" data-level="" data-path="introduction-to-r.html"><a href="introduction-to-r.html#loading-packages"><i class="fa fa-check"></i>Loading packages</a></li>
<li class="chapter" data-level="" data-path="introduction-to-r.html"><a href="introduction-to-r.html#saving-your-objects-plots-and-scripts"><i class="fa fa-check"></i>Saving your objects, plots and scripts</a></li>
<li class="chapter" data-level="" data-path="introduction-to-r.html"><a href="introduction-to-r.html#knowing-where-r-saves-your-documents"><i class="fa fa-check"></i>Knowing where R saves your documents</a></li>
<li class="chapter" data-level="" data-path="introduction-to-r.html"><a href="introduction-to-r.html#practicing-in-r"><i class="fa fa-check"></i>Practicing in R</a></li>
<li class="chapter" data-level="" data-path="introduction-to-r.html"><a href="introduction-to-r.html#one-final-note"><i class="fa fa-check"></i>One final note</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="week-1-exercise.html"><a href="week-1-exercise.html"><i class="fa fa-check"></i>Week 1 Exercise</a><ul>
<li class="chapter" data-level="" data-path="week-1-exercise.html"><a href="week-1-exercise.html#investigating-support-for-sisi-in-egypt"><i class="fa fa-check"></i>Investigating support for Sisi in Egypt</a></li>
<li class="chapter" data-level="" data-path="week-1-exercise.html"><a href="week-1-exercise.html#preparing-the-dataset"><i class="fa fa-check"></i>Preparing the dataset</a></li>
<li class="chapter" data-level="" data-path="week-1-exercise.html"><a href="week-1-exercise.html#visualizing-the-data"><i class="fa fa-check"></i>Visualizing the data</a></li>
<li class="chapter" data-level="" data-path="week-1-exercise.html"><a href="week-1-exercise.html#subsetting-the-data"><i class="fa fa-check"></i>Subsetting the data</a></li>
<li class="chapter" data-level="" data-path="week-1-exercise.html"><a href="week-1-exercise.html#coding-tasks"><i class="fa fa-check"></i>Coding tasks</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="week-2-exercise.html"><a href="week-2-exercise.html"><i class="fa fa-check"></i>Week 2 Exercise</a><ul>
<li class="chapter" data-level="" data-path="week-2-exercise.html"><a href="week-2-exercise.html#analysing-protest-in-the-syrian-revolution"><i class="fa fa-check"></i>Analysing protest in the Syrian Revolution</a></li>
<li class="chapter" data-level="" data-path="week-2-exercise.html"><a href="week-2-exercise.html#read-in-the-data"><i class="fa fa-check"></i>Read in the data</a></li>
<li class="chapter" data-level="" data-path="week-2-exercise.html"><a href="week-2-exercise.html#time-series-plots"><i class="fa fa-check"></i>Time-series plots</a></li>
<li><a href="week-2-exercise.html#using-the-tidyverse">Using the <tt>tidyverse</tt></a></li>
<li><a href="week-2-exercise.html#using-ggplot">Using <tt>ggplot</tt></a></li>
<li class="chapter" data-level="" data-path="week-2-exercise.html"><a href="week-2-exercise.html#working-with-dates"><i class="fa fa-check"></i>Working with dates</a></li>
<li class="chapter" data-level="" data-path="week-2-exercise.html"><a href="week-2-exercise.html#visualizing-data-on-maps"><i class="fa fa-check"></i>Visualizing data on maps:</a></li>
<li class="chapter" data-level="" data-path="week-2-exercise.html"><a href="week-2-exercise.html#coding-tasks-1"><i class="fa fa-check"></i>Coding tasks</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="week-3-exercise.html"><a href="week-3-exercise.html"><i class="fa fa-check"></i>Week 3 Exercise</a><ul>
<li class="chapter" data-level="" data-path="week-3-exercise.html"><a href="week-3-exercise.html#contingency-tables"><i class="fa fa-check"></i>Contingency tables</a></li>
<li class="chapter" data-level="" data-path="week-3-exercise.html"><a href="week-3-exercise.html#recoding-variables"><i class="fa fa-check"></i>Recoding variables</a></li>
<li class="chapter" data-level="" data-path="week-3-exercise.html"><a href="week-3-exercise.html#visualizing-spatial-data"><i class="fa fa-check"></i>Visualizing spatial data</a></li>
<li class="chapter" data-level="" data-path="week-3-exercise.html"><a href="week-3-exercise.html#back-to-the-mena"><i class="fa fa-check"></i>Back to the MENA</a></li>
<li class="chapter" data-level="" data-path="week-3-exercise.html"><a href="week-3-exercise.html#coding-tasks-2"><i class="fa fa-check"></i>Coding tasks</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="week-4-exercise.html"><a href="week-4-exercise.html"><i class="fa fa-check"></i>Week 4 Exercise</a><ul>
<li class="chapter" data-level="" data-path="week-4-exercise.html"><a href="week-4-exercise.html#preparing-and-plotting-the-data"><i class="fa fa-check"></i>Preparing and plotting the data</a></li>
<li class="chapter" data-level="" data-path="week-4-exercise.html"><a href="week-4-exercise.html#conducting-t-tests"><i class="fa fa-check"></i>Conducting t-tests</a></li>
<li><a href="week-4-exercise.html#using-gtrendsr">Using <tt>gtrendsR</tt></a></li>
<li class="chapter" data-level="" data-path="week-4-exercise.html"><a href="week-4-exercise.html#coding-tasks-3"><i class="fa fa-check"></i>Coding tasks</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MMES Quantitative Research Methods Oxford 2021</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="week-2-exercise" class="section level1 unnumbered">
<h1>Week 2 Exercise</h1>
<div id="analysing-protest-in-the-syrian-revolution" class="section level2 unnumbered">
<h2>Analysing protest in the Syrian Revolution</h2>
<p>This week we are analysing event data. Event data takes multiple forms, as we saw from the readings this week. Often, it takes the form of so-called “event catalogues”. See <a href="https://journals.sagepub.com/doi/10.1111/1467-9558.00161">this article</a> by Charles Tilly for an overview of their use and some theoretical reflections on what they can teach us. The data we will be using this week comes from a recently published <a href="https://journals.sagepub.com/doi/abs/10.1177/0010414018806536?journalCode=cpsa">article</a> by Kevin Mazur on the patterns of protest (or “challenge”) seen during the early stages of the 2011 Syrian Uprising. The original replication materials can be found <a href="https://journals.sagepub.com/doi/suppl/10.1177/0010414018806536">here</a>. Download them from here if you want to get all of the files. Alternatively, you can download them from my GitHub page as below.</p>
</div>
<div id="read-in-the-data" class="section level2 unnumbered">
<h2>Read in the data</h2>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="week-2-exercise.html#cb39-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb39-2"><a href="week-2-exercise.html#cb39-2"></a><span class="kw">library</span>(ggthemes)</span>
<span id="cb39-3"><a href="week-2-exercise.html#cb39-3"></a><span class="kw">library</span>(tsibble)</span>
<span id="cb39-4"><a href="week-2-exercise.html#cb39-4"></a><span class="kw">library</span>(sf)</span>
<span id="cb39-5"><a href="week-2-exercise.html#cb39-5"></a></span>
<span id="cb39-6"><a href="week-2-exercise.html#cb39-6"></a>syr_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/cjbarrie/teaching_material/50588a5f9ae7f1a3a343c7bdcef8df7acd8f38c3/event_db.csv&quot;</span>,</span>
<span id="cb39-7"><a href="week-2-exercise.html#cb39-7"></a>                        <span class="dt">stringsAsFactors=</span>F)</span></code></pre></div>
<p>Let’s start by viewing the dataset. We can see that it contains information on the challenge events in the early stages of the Syrian Revolution described by Mazur in the case study <a href="https://journals.sagepub.com/doi/abs/10.1177/0010414018806536?journalCode=cpsa">article</a> we looked at for this week.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="week-2-exercise.html#cb40-1"></a><span class="kw">View</span>(syr_data)</span></code></pre></div>
<p>And then we’ll check to see how each variable is stored:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="week-2-exercise.html#cb41-1"></a><span class="kw">str</span>(syr_data)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    2954 obs. of  26 variables:
##  $ l4_pcode   : chr  &quot;C1001&quot; &quot;C1001&quot; &quot;C1001&quot; &quot;C1001&quot; ...
##  $ date_start : chr  &quot;2011-02-02&quot; &quot;2011-02-04&quot; &quot;2011-02-17&quot; &quot;2011-02-22&quot; ...
##  $ ch_pcfl    : int  1 1 1 1 1 1 1 0 0 0 ...
##  $ ch_sviol   : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ ch_cviol   : int  0 0 0 0 0 0 0 1 0 0 ...
##  $ st_crctrl  : int  1 0 1 1 0 1 1 0 0 0 ...
##  $ st_tactrl  : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ st_confront: int  0 0 0 0 0 0 0 1 0 0 ...
##  $ st_destroy : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ al_nviol   : int  0 0 1 0 0 1 0 0 1 1 ...
##  $ al_viol    : int  0 0 0 0 1 0 0 0 0 0 ...
##  $ time       : int  1 3 16 21 42 43 45 420 315 286 ...
##  $ l1_pcode   : chr  &quot;SY01&quot; &quot;SY01&quot; &quot;SY01&quot; &quot;SY01&quot; ...
##  $ l1_ar      : chr  &quot;مدينة دمشق&quot; &quot;مدينة دمشق&quot; &quot;مدينة دمشق&quot; &quot;مدينة دمشق&quot; ...
##  $ l1_en      : chr  &quot;Damascus&quot; &quot;Damascus&quot; &quot;Damascus&quot; &quot;Damascus&quot; ...
##  $ l2_pcode   : chr  &quot;SY0100&quot; &quot;SY0100&quot; &quot;SY0100&quot; &quot;SY0100&quot; ...
##  $ l2_ar      : chr  &quot;مدينة دمشق&quot; &quot;مدينة دمشق&quot; &quot;مدينة دمشق&quot; &quot;مدينة دمشق&quot; ...
##  $ l2_en      : chr  &quot;Damascus&quot; &quot;Damascus&quot; &quot;Damascus&quot; &quot;Damascus&quot; ...
##  $ l3_pcode   : chr  &quot;SY010000&quot; &quot;SY010000&quot; &quot;SY010000&quot; &quot;SY010000&quot; ...
##  $ l3_ar      : chr  &quot;مدينة دمشق&quot; &quot;مدينة دمشق&quot; &quot;مدينة دمشق&quot; &quot;مدينة دمشق&quot; ...
##  $ l3_en      : chr  &quot;Damascus&quot; &quot;Damascus&quot; &quot;Damascus&quot; &quot;Damascus&quot; ...
##  $ l4_ar      : chr  &quot;دمشق&quot; &quot;دمشق&quot; &quot;دمشق&quot; &quot;دمشق&quot; ...
##  $ l4_en      : chr  &quot;Damascus&quot; &quot;Damascus&quot; &quot;Damascus&quot; &quot;Damascus&quot; ...
##  $ p1         : int  1 1 1 1 1 1 1 0 0 0 ...
##  $ p2         : int  0 0 0 0 0 0 0 0 1 1 ...
##  $ p3         : int  0 0 0 0 0 0 0 1 0 0 ...</code></pre>
</div>
<div id="time-series-plots" class="section level2 unnumbered">
<h2>Time-series plots</h2>
<p>We can see that it contains columns on the type of challenge events seen over time as well as the locations and dates of their occurrence. We will first create a ‘time series’ plot of events over time. Like last week, we first wrangle the data into an appropriate format for visualizing it in this way.</p>
<p>Since each row represents an event, we first create a variable, which we’ll name <em>event</em> and that records solely so-called “challenger” events (as opposed to regime repression events, which are also included in the dataset). The code to do this requires us to name a new variable in the original event dataset and sum together two columns in the event dataset named <em>ch_pcfl</em> and <em>ch_sviol</em>, which contain 1s and 0s denoting whether the challenge event was peaceful or violent.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="week-2-exercise.html#cb43-1"></a>syr_data<span class="op">$</span>event &lt;-<span class="st"> </span>syr_data<span class="op">$</span>ch_pcfl <span class="op">+</span><span class="st"> </span>syr_data<span class="op">$</span>ch_sviol</span></code></pre></div>
<p>As with the survey data we studied last week, we can then wrangle and reshape this data into a format suitable for a timeseries plot (essentially a graph of events over time). For this, we need to know first the number of events witnessed per day. We can see in the dataset that the date is recorded in yyyy-mm-dd format. This makes conversion to an R-readable date pretty straightforward. For more practice on working with dates in R, see this <a href="https://campus.datacamp.com/courses/intermediate-r-for-finance/dates?ex=6">online tutorial</a>. To make sure this date is readable in R, we simply type:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="week-2-exercise.html#cb44-1"></a>syr_data<span class="op">$</span>date &lt;-<span class="st"> </span><span class="kw">as.Date</span>(syr_data<span class="op">$</span>date)</span></code></pre></div>
<p>To make sure these have converted properly we can have a glimpse at the data using the <code>glimpse()</code> function, which is part of the <tt>tidyverse</tt> package.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="week-2-exercise.html#cb45-1"></a><span class="kw">glimpse</span>(syr_data<span class="op">$</span>date)</span></code></pre></div>
<pre><code>##  Date[1:2954], format: &quot;2011-02-02&quot; &quot;2011-02-04&quot; &quot;2011-02-17&quot; &quot;2011-02-22&quot; &quot;2011-03-15&quot; &quot;2011-03-16&quot; &quot;2011-03-18&quot; &quot;2012-03-27&quot; &quot;2011-12-13&quot; &quot;2011-11-14&quot; &quot;2011-03-29&quot; &quot;2011-11-09&quot; &quot;2011-07-21&quot; &quot;2012-01-27&quot; &quot;2012-01-03&quot; ...</code></pre>
<p>As in weeks past, all we are doing here is passing an existing object—the vector (i.e., column) of dates—through a function, this time called <code>as.Date</code> (a function from base R; i.e., you don’t need any extra packages to run this command), which translates the date into R-readable format.</p>
<p>We can then begin to wrangle the data into a format appropriate for visualizing timeseries data. In the below, we subset the original event dataset, summing the events by date to arrive at a daily count of challenge events.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="week-2-exercise.html#cb47-1"></a><span class="co"># get events by date using tidyverse:</span></span>
<span id="cb47-2"><a href="week-2-exercise.html#cb47-2"></a></span>
<span id="cb47-3"><a href="week-2-exercise.html#cb47-3"></a>syr_events_ts &lt;-<span class="st">  </span>syr_data <span class="op">%&gt;%</span></span>
<span id="cb47-4"><a href="week-2-exercise.html#cb47-4"></a><span class="st">  </span><span class="kw">group_by</span>(date) <span class="op">%&gt;%</span></span>
<span id="cb47-5"><a href="week-2-exercise.html#cb47-5"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">sum_event =</span> <span class="kw">sum</span>(event))</span></code></pre></div>
</div>
<div id="using-the-tidyverse" class="section level2 unnumbered">
<h2>Using the <tt>tidyverse</tt></h2>
<p>Here, we’re using so-called “pipe operators”. You have already encountered the subsetting function <code>subset()</code> in your labs. We also used these once or twice in the coding sheets last week. The <code>tidyverse</code> is essentially a more intuitive way of reshaping data. I basically only use this for wrangling (reshaping) data. For a good tutorial showing its potential for this, see this <a href="https://jules32.github.io/2016-07-12-Oxford/dplyr_tidyr/">page</a>. Basically pipe operators “pipe” (or pass on) what is on the left-hand side to what is on the right, and so on in turn. In this respect, it is a more intuitive way to reshape data than the methods provided in base R. So what are we doing here? The first part of this code <code>syr_events_ts</code> simply names the new subset of data we’re creating. To this we’re passing (with the &lt;- operator) the already imported <code>syr_data</code> dataframe. But instead of just passing this object, we’re telling R to reshape it (the code on the right-hand side after the pipes) before passing it back to our new <code>syr_events_ts</code> dataframe. Here, we’re saying: take <code>syr_data</code>, group that data by by date <code>(group_by(date)</code>, then sum the events by date <code>summarize(sum_event = sum(event))</code>. Then this is all passed back to (stored as) the object <code>syr_events_ts</code>. Have a look at the new dataframe by typing<code>View(syr_events_ts)</code>. You’ll see that it shows a series of dates alongside the summed event values.</p>
<p>We can then plot a timeseries of challenge events by date using the <tt>ggplot2</tt> package that we used last week. Note that we’re using here the <code>theme_tufte()</code> styling option that comes with the <tt>ggthemes</tt> package. This is solely to make the graph look nicer!</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="week-2-exercise.html#cb48-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> syr_events_ts, </span>
<span id="cb48-2"><a href="week-2-exercise.html#cb48-2"></a>       <span class="kw">aes</span>(<span class="dt">x=</span>date, <span class="dt">y =</span> sum_event)) <span class="op">+</span></span>
<span id="cb48-3"><a href="week-2-exercise.html#cb48-3"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb48-4"><a href="week-2-exercise.html#cb48-4"></a><span class="st">  </span><span class="kw">theme_tufte</span>(<span class="dt">base_family=</span> <span class="st">&quot;Helvetica&quot;</span>) <span class="op">+</span></span>
<span id="cb48-5"><a href="week-2-exercise.html#cb48-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Syria challenge events 2011-2012&quot;</span>,</span>
<span id="cb48-6"><a href="week-2-exercise.html#cb48-6"></a>       <span class="dt">subtitle =</span> <span class="st">&quot;Data from Mazur (2018)&quot;</span>,</span>
<span id="cb48-7"><a href="week-2-exercise.html#cb48-7"></a>       <span class="dt">y =</span> <span class="st">&quot;# Challenge events&quot;</span>,</span>
<span id="cb48-8"><a href="week-2-exercise.html#cb48-8"></a>       <span class="dt">x =</span> <span class="st">&quot;Date&quot;</span>)</span></code></pre></div>
<p><img src="MMES-2021_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
</div>
<div id="using-ggplot" class="section level2 unnumbered">
<h2>Using <tt>ggplot</tt></h2>
<p>So what’s going on here? <tt>ggplot</tt> commands basically just require you first to specify what dataframe we’re using; i.e., <code>ggplot(syr_events_ts,</code> and after the comma we have a section where we specify our “aesthetic mappings” (or <code>aes</code>). In other words, this is where we specify what we want on the x- and y-axis. Given that this is a timeseries plot, we have date on the x- (horizontal) axis and the sum of events on the y-axis. We then specify what type of graph we want. Here, we select <code>geom_line</code> as we want a line connecting the value of observations over time. Everything after <code>geom_line</code> is included just to specify labels and the theme (i.e., styling) of the graph. Remove this and see what happens. For graphs like this, in other words, we could have used only the following code:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="week-2-exercise.html#cb49-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> syr_events_ts, </span>
<span id="cb49-2"><a href="week-2-exercise.html#cb49-2"></a>       <span class="kw">aes</span>(<span class="dt">x=</span>date, <span class="dt">y =</span> sum_event)) <span class="op">+</span></span>
<span id="cb49-3"><a href="week-2-exercise.html#cb49-3"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p>A ggplot of this sort is composed of only two parenthetical elements, then. The first specifies what the data is and what is to be plotted. The second specifies type of graph. Here, we’re plotting with <code>geom_line</code> though we could also plot with <code>geom_bar</code> or <code>geom_area</code>. Try plotting with these different arguments and see which one gives the best visualization. Note: for reasons that are bit involved and you don’t need to worry out, when specifying <code>geom_area</code> and <code>geom_bar</code> you also need to add the <code>stat = "identity"</code> argument.</p>
</div>
<div id="working-with-dates" class="section level2 unnumbered">
<h2>Working with dates</h2>
<p>We might also want to look into the patterning of violent and peaceful events over time. To facilitate interpretation, we’ll first aggregate over a higher level of temporal aggregation and sum events by week. We can do this with the package <tt>tsibble</tt> (for more information on this package and another package–<tt>lubridate</tt>–useful for reshaping timeseries data, see <a href="https://cran.rstudio.com/web/packages/tsibble/vignettes/intro-tsibble.html">these</a> <a href="https://lubridate.tidyverse.org/">pages</a>).</p>
<p>Before doing that, we need to generate a categorical variable that records whether or not the event in question is a peaceful or violent challenge event. For a good tutorial on recoding variables, see <a href="http://rprogramming.net/recode-data-in-r/">this page</a>.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="week-2-exercise.html#cb50-1"></a><span class="co">#generate categorical var. for event type:</span></span>
<span id="cb50-2"><a href="week-2-exercise.html#cb50-2"></a></span>
<span id="cb50-3"><a href="week-2-exercise.html#cb50-3"></a>syr_data<span class="op">$</span>event_type[syr_data<span class="op">$</span>ch_pcfl<span class="op">==</span><span class="dv">1</span>]  &lt;-<span class="st"> &quot;Peaceful&quot;</span></span>
<span id="cb50-4"><a href="week-2-exercise.html#cb50-4"></a>syr_data<span class="op">$</span>event_type[syr_data<span class="op">$</span>ch_sviol<span class="op">==</span><span class="dv">1</span>]  &lt;-<span class="st"> &quot;Violent&quot;</span></span>
<span id="cb50-5"><a href="week-2-exercise.html#cb50-5"></a></span>
<span id="cb50-6"><a href="week-2-exercise.html#cb50-6"></a><span class="co">#generate timeseries data aggregated to date:</span></span>
<span id="cb50-7"><a href="week-2-exercise.html#cb50-7"></a>syr_events_ts &lt;-<span class="st">  </span>syr_data <span class="op">%&gt;%</span></span>
<span id="cb50-8"><a href="week-2-exercise.html#cb50-8"></a><span class="st">  </span><span class="kw">group_by</span>(event_type, date) <span class="op">%&gt;%</span></span>
<span id="cb50-9"><a href="week-2-exercise.html#cb50-9"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">sum_event =</span> <span class="kw">sum</span>(event))</span></code></pre></div>
<p>Have a look at the new dataframe <code>syr_events_ts</code> and see how it is structured. Make sure it is clear in your mind how observations are being summed and grouped.</p>
<p>Next up we generate our “year-week” variable. Since events run over more than one year, we cannot just generate a week variable (i.e., taking values 1-52) as we will have the same number week repeated over multiple years. Summing over these weeks together would be nonsensical. Instead, we combine the week and year to make sure that we sum over e.g., week 12 of 2011 and not week 12 of 2011 and 2012.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="week-2-exercise.html#cb51-1"></a><span class="co"># generate year-week column</span></span>
<span id="cb51-2"><a href="week-2-exercise.html#cb51-2"></a>syr_events_ts<span class="op">$</span>yrweek &lt;-<span class="st"> </span><span class="kw">yearweek</span>(syr_events_ts<span class="op">$</span>date)</span>
<span id="cb51-3"><a href="week-2-exercise.html#cb51-3"></a></span>
<span id="cb51-4"><a href="week-2-exercise.html#cb51-4"></a><span class="co"># group again by year-week</span></span>
<span id="cb51-5"><a href="week-2-exercise.html#cb51-5"></a>syr_events_ts_week &lt;-<span class="st">  </span>syr_events_ts <span class="op">%&gt;%</span></span>
<span id="cb51-6"><a href="week-2-exercise.html#cb51-6"></a><span class="st">  </span><span class="kw">group_by</span>(event_type, yrweek) <span class="op">%&gt;%</span></span>
<span id="cb51-7"><a href="week-2-exercise.html#cb51-7"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">sum_event =</span> <span class="kw">sum</span>(sum_event))</span></code></pre></div>
<p>Have a look at the dataframe <code>syr_events_ts</code> to see what the <em>yrweek</em> variable looks like.</p>
<p>Note that when we plot this data we specify <code>na.omit()</code> before the name of the data we’re plotting in order to remove missing observations. We also add the <code>facet_grid</code> argument to tell R to plot over a ‘facet’ (separate graph on same plot). In other contexts, we might facet by date, by location or otherwise. Here, we’re facetting by event type, which comes after a ~ (tilde) sign.</p>
<p>You’ll notice as well that we’ve added <code>fill = event_type</code> to the aesthetic (<code>aes</code>) components of our plot. This just means that each event type will have a different color associated with it. Try adding and removing components in the plot to work out which parts are responsible for which elements of the graph. Try also changing the fill option to <code>shape</code> and see what results. You’ll find a great website to use when selecting hex colours <a href="https://htmlcolorcodes.com/">here</a>.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="week-2-exercise.html#cb52-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">na.omit</span>(syr_events_ts_week),</span>
<span id="cb52-2"><a href="week-2-exercise.html#cb52-2"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> yrweek, <span class="dt">y =</span> sum_event, </span>
<span id="cb52-3"><a href="week-2-exercise.html#cb52-3"></a>           <span class="dt">fill =</span> event_type)) <span class="op">+</span></span>
<span id="cb52-4"><a href="week-2-exercise.html#cb52-4"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span></span>
<span id="cb52-5"><a href="week-2-exercise.html#cb52-5"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>event_type) <span class="op">+</span></span>
<span id="cb52-6"><a href="week-2-exercise.html#cb52-6"></a><span class="st">  </span><span class="kw">theme_tufte</span>(<span class="dt">base_family =</span> <span class="st">&quot;Helvetica&quot;</span>) <span class="op">+</span></span>
<span id="cb52-7"><a href="week-2-exercise.html#cb52-7"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#007A3D&quot;</span>, <span class="st">&quot;#CE1126&quot;</span>)) <span class="op">+</span></span>
<span id="cb52-8"><a href="week-2-exercise.html#cb52-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill=</span><span class="st">&quot;Event type&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Date&quot;</span>, <span class="dt">y=</span><span class="st">&quot;# Events&quot;</span>)</span></code></pre></div>
<p><img src="MMES-2021_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<p>It might, however, be more informative to plot these two graphs on top of each other. This is achieved very straightforwardly. All we need to do, instead of facetting, is to add a ‘fill’ argument and to use event type as the variable by which we’re filling. The graphs will then be plotted on top of eachother.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="week-2-exercise.html#cb53-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">na.omit</span>(syr_events_ts_week),</span>
<span id="cb53-2"><a href="week-2-exercise.html#cb53-2"></a>       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> yrweek, <span class="dt">y =</span> sum_event, </span>
<span id="cb53-3"><a href="week-2-exercise.html#cb53-3"></a>                     <span class="dt">fill =</span> event_type)) <span class="op">+</span></span>
<span id="cb53-4"><a href="week-2-exercise.html#cb53-4"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">alpha=</span><span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb53-5"><a href="week-2-exercise.html#cb53-5"></a><span class="st">  </span><span class="kw">theme_tufte</span>(<span class="dt">base_family =</span> <span class="st">&quot;Helvetica&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb53-6"><a href="week-2-exercise.html#cb53-6"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#007A3D&quot;</span>, <span class="st">&quot;#CE1126&quot;</span>)) <span class="op">+</span></span>
<span id="cb53-7"><a href="week-2-exercise.html#cb53-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Date&quot;</span>, <span class="dt">y=</span><span class="st">&quot;# Events&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;Event type&quot;</span>)</span></code></pre></div>
<p><img src="MMES-2021_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
</div>
<div id="visualizing-data-on-maps" class="section level2 unnumbered">
<h2>Visualizing data on maps:</h2>
<p><strong>Disclaimer</strong>: in previous years, this section was deemed a bit too advanced. I really urge you to give this a go though: especially as we are going to be talking about, and working with, spatial data next week. On the surface, mapping spatial data looks challenging. But in essence we are just doing similar things here to what we’ve done above and in the previous week. The difficulty comes in the forms of data used (shapefiles are notoriously messy) and in joining together (“merging”) different forms of data. Give it a go! And don’t be dissuaded if this proves too difficult at this stage. That’s what my office hours are for :)</p>
<p>There are several excellent resources you can use to learn more about mapping in R. The first and best is Robin Lovelace’s book <em>Geocomputation with R</em>, which he has made freely available <a href="https://geocompr.robinlovelace.net/adv-map.html">here</a>.</p>
<p>All we need to plot a map when using this sort of data is to go through three easy steps. We first need to identify the unit over which we’re mapping; i.e., are we mapping over districts, governorates, provinces etc.? In the below, we are mapping over each of the fourteen governorates of Syria.</p>
<p>We next need to obtain what is known as a ‘shapefile’. This is simply the format of file (overly complicated and in need of reforming) most commonly used to store GIS data. In this example, it is a set of polygons with associated coordinates that map out the governorates of Syria. But you don’t need to worry too much about the complexities of how this data is stored. We can download shapefiles from several places. Here, I use the <a href="https://data.humdata.org/dataset/syrian-arab-republic-administrative-boundaries-populated-places">Humanitarian Data Exchange</a> but <a href="http://www.diva-gis.org/gdata">diva-gis</a> is also a good place to look.</p>
<p>For the purposes of this exercise you can download the shapefiles I use from my GitHub page <a href="https://github.com/cjbarrie/teaching_material">here</a>, making sure to download all of the syr_admin1 files with different file extensions (shapefiles come in multiple parts even though we only end up actually reading in the .shp file…).</p>
<p>You then need to make sure, once you’ve downloaded them, that they’re in your “working directory” when you read them from the RStudio Console. You can do this with the <code>setwd()</code> function. We read in the shapefile with a command included in the <tt>sf</tt> package.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="week-2-exercise.html#cb54-1"></a>syr_shp &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;syr_admin1.shp&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `syr_admin1&#39; from data source `/Users/christopherbarrie/Dropbox/Teaching/02_Github/MMES-Ox/MMES-2021/other_files/syr_admin1.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 14 features and 8 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: 35.61394 ymin: 32.31644 xmax: 42.38504 ymax: 37.31914
## geographic CRS: WGS 84</code></pre>
<p>We can then use <tt>ggplot</tt> again to visualize these! The only difference from the above is that instead of specifying e.g. <code>geom_bar()</code> or similar we specify <code>geom_sf</code> as here we want to visualize an “sf” type object; i.e., spatial data.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="week-2-exercise.html#cb56-1"></a><span class="kw">ggplot</span>(syr_shp) <span class="op">+</span></span>
<span id="cb56-2"><a href="week-2-exercise.html#cb56-2"></a><span class="st">  </span><span class="kw">geom_sf</span>()</span></code></pre></div>
<p><img src="MMES-2021_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<p>Now we need to check how governorate names are recorded in the spatial data. Given that the shapefiles have been read into the R Console as an “sf” object we can view them in the same way as we would any dataframe object.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="week-2-exercise.html#cb57-1"></a><span class="co">#check spelling of governorates in English</span></span>
<span id="cb57-2"><a href="week-2-exercise.html#cb57-2"></a><span class="kw">print</span>(syr_shp<span class="op">$</span>NAME_EN)</span></code></pre></div>
<pre><code>##  [1] &quot;Damascus&quot;       &quot;Aleppo&quot;         &quot;Rural Damascus&quot; &quot;Homs&quot;           &quot;Hama&quot;           &quot;Lattakia&quot;       &quot;Idleb&quot;          &quot;Al-Hasakeh&quot;     &quot;Deir-ez-Zor&quot;    &quot;Tartous&quot;        &quot;Ar-Raqqa&quot;      
## [12] &quot;Dar&#39;a&quot;          &quot;As-Sweida&quot;      &quot;Quneitra&quot;</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="week-2-exercise.html#cb59-1"></a><span class="co">#check spelling of governorates in Arabic</span></span>
<span id="cb59-2"><a href="week-2-exercise.html#cb59-2"></a><span class="kw">print</span>(syr_shp<span class="op">$</span>NAME_AR)</span></code></pre></div>
<pre><code>##  [1] &quot;دمشق&quot;      &quot;حلب&quot;       &quot;ريف دمشق&quot;  &quot;حمص&quot;       &quot;حماة&quot;      &quot;اللاذقية&quot;  &quot;إدلب&quot;      &quot;الحسكة&quot;    &quot;دير الزور&quot; &quot;طرطوس&quot;     &quot;الرقة&quot;     &quot;درعا&quot;      &quot;السويداء&quot;  &quot;القنيطرة&quot;</code></pre>
<p>Now that we know the names of the governorates, we can prepare the data that we want to merge with this file. In merging, we are essentially attaching data to the shapefile so that it can be plotted. In this example, we are assigning events to particular geographical regions, or governorates, for the purposes of visualizing them spatially. Imagine this as essentially taking two spreadsheets containing different information and joining them together at the seams.</p>
<p>First, we sum events (and here we recode events as all events in the dataset) over the governorate identifier in the Mazur data (<em>l1_en</em>). We then give this column the same name as that used in the shapefile (<em>NAME_EN</em>) so that we can merge by this column.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="week-2-exercise.html#cb61-1"></a>syr_data<span class="op">$</span>event &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb61-2"><a href="week-2-exercise.html#cb61-2"></a></span>
<span id="cb61-3"><a href="week-2-exercise.html#cb61-3"></a><span class="co"># get events by l1_en (governorate names)</span></span>
<span id="cb61-4"><a href="week-2-exercise.html#cb61-4"></a>syr_events &lt;-<span class="st">  </span>syr_data <span class="op">%&gt;%</span></span>
<span id="cb61-5"><a href="week-2-exercise.html#cb61-5"></a><span class="st">  </span><span class="kw">group_by</span>(l1_en) <span class="op">%&gt;%</span></span>
<span id="cb61-6"><a href="week-2-exercise.html#cb61-6"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">sum_event =</span> <span class="kw">sum</span>(event)) <span class="op">%&gt;%</span></span>
<span id="cb61-7"><a href="week-2-exercise.html#cb61-7"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">NAME_EN =</span> l1_en)</span>
<span id="cb61-8"><a href="week-2-exercise.html#cb61-8"></a></span>
<span id="cb61-9"><a href="week-2-exercise.html#cb61-9"></a><span class="co">#merge with event data</span></span>
<span id="cb61-10"><a href="week-2-exercise.html#cb61-10"></a>syr_shp_merged &lt;-<span class="st"> </span><span class="kw">merge</span>(syr_shp, syr_events, <span class="dt">by=</span><span class="st">&quot;NAME_EN&quot;</span>)</span></code></pre></div>
<p>Most of the above will be familiar. Subsetting the data uses a procedure pretty much identical to that used above except this time we are grouping by a geographical identifier (<em>l1_en</em>). Note how reshaping data looks pretty much the same regardless of what the type of data is and what we want to do with it—normally, we’re just summing over a relevant variable. We then rename this variable to <em>NAME_EN</em> so that it matches by the name of the relevant column in our spatial data.</p>
<p>Then we can merge the shapefile with the aggregated event data by typing <code>syr_shp &lt;- merge(syr_shp, syr_events, by="NAME_EN")</code>. Here, we’re simply pasting the names of the two objects to be merged—<em>syr_shp</em> and <em>syr_events</em>—separated by commas and then specifying the name of the common identifier by writing <code>by="NAME_EN"</code>.</p>
<p>We’re now ready to plot the map!</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="week-2-exercise.html#cb62-1"></a><span class="kw">ggplot</span>(syr_shp_merged) <span class="op">+</span></span>
<span id="cb62-2"><a href="week-2-exercise.html#cb62-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill=</span>sum_event), <span class="dt">lwd=</span>.<span class="dv">1</span>)</span></code></pre></div>
<p><img src="MMES-2021_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p>And given that this is just another <tt>ggplot</tt> object we’re working with, this means we can use the same styling options as we’ve seen above. The variable we are visualizing in the fill colour of our governorates is continuous (a count of events). This means it is appropriate to use a continuous color palette when styling this visualization. We can do this by specifying <code>scale_fill_continous()</code> and adding values for the colours we want to use. Here, we just need to provide “low” and “high” values, and the intervening colours will be selected automatically.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="week-2-exercise.html#cb63-1"></a><span class="kw">ggplot</span>(syr_shp_merged) <span class="op">+</span></span>
<span id="cb63-2"><a href="week-2-exercise.html#cb63-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill=</span>sum_event), <span class="dt">lwd=</span>.<span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb63-3"><a href="week-2-exercise.html#cb63-3"></a><span class="st">  </span><span class="kw">scale_fill_continuous</span>(<span class="dt">low =</span> <span class="st">&quot;#544545&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;#990000&quot;</span>) <span class="op">+</span></span>
<span id="cb63-4"><a href="week-2-exercise.html#cb63-4"></a><span class="st">  </span><span class="kw">theme_tufte</span>(<span class="dt">base_family =</span> <span class="st">&quot;Helvetica&quot;</span>) <span class="op">+</span></span>
<span id="cb63-5"><a href="week-2-exercise.html#cb63-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;# Events&quot;</span>)</span></code></pre></div>
<p><img src="MMES-2021_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
</div>
<div id="coding-tasks-1" class="section level2 unnumbered">
<h2>Coding tasks</h2>
<ul>
<li><p>Recode a new event type variable (using e.g., events beginning with the <em>st_</em> prefix) as we did above, applying categorical codes to each type.</p></li>
<li><p>Produce a table of summary statistics for the Syria event dataset. Tip: research the <tt>stargazer</tt> package.</p></li>
<li><p>Plot a new map using a different type of event variable. Bonus task: restyle the map, changing e.g., colours, polygon line thickness, transparency etc. etc.</p></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="week-1-exercise.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="week-3-exercise.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/08-week2ex.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["MMES-2021.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
